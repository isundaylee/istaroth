# Default values for istaroth.

# Backend configuration
backend:
  replicaCount: 1
  image:
    repository: isundaylee/istaroth
    tag: latest
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 8000

  resources:
    limits:
      cpu: 6
      memory: 6Gi
    requests:
      cpu: 1
      memory: 1Gi

  # Environment variables - supports both direct values and valueFrom references
  # Add deployment-specific environment variables here
  env: []
    # Example: Database URI from secret (REQUIRED)
    # - name: ISTAROTH_DATABASE_URI
    #   valueFrom:
    #     secretKeyRef:
    #       name: db-credentials
    #       key: database-uri

    # Secrets are managed via SealedSecrets
    # Create a SealedSecret that generates a Secret named: {release-name}-secret

  probes:
    liveness:
      httpGet:
        path: /api/models
        port: 8000
      initialDelaySeconds: 30
      periodSeconds: 10
    readiness:
      httpGet:
        path: /api/models
        port: 8000
      initialDelaySeconds: 5
      periodSeconds: 5

# Frontend configuration
frontend:
  replicaCount: 1
  image:
    repository: isundaylee/istaroth-frontend
    tag: latest
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 80

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

  env: {}

  probes:
    liveness:
      httpGet:
        path: /
        port: 8080
      initialDelaySeconds: 10
      periodSeconds: 10
      failureThreshold: 20
    readiness:
      httpGet:
        path: /
        port: 8080
      initialDelaySeconds: 5
      periodSeconds: 5

# ConfigMap for application configuration
configmap:
  data:
    ISTAROTH_DOCUMENT_STORE_SET: "CHS:/data/checkpoint_web/chs,ENG:/data/checkpoint_web/eng"
    ISTAROTH_DOWNLOAD_CHECKPOINT_RELEASE: "1"
    ISTAROTH_AVAILABLE_MODELS: "all"
    ISTAROTH_QUERY_TRANSFORMER: "rewrite"
    ISTAROTH_RERANKER: "cohere"

# Persistent storage configuration for backend application data
persistence:
  storageClass: ""  # Leave empty to use default storage class
  accessMode: ReadWriteOnce
  size: 10Gi


# Service configuration
service:
  type: ClusterIP
  annotations: {}

# Ingress configuration
ingress:
  enabled: false
  className: traefik
  annotations: {}
  hosts:
    - host: istaroth.example.com

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Container security context
containerSecurityContext: {}

# Additional labels
labels: {}

# Additional annotations
annotations: {}

# External Chroma services configuration
chroma:
  # Chroma container image
  image:
    repository: chromadb/chroma
    tag: latest
    pullPolicy: Always

  # Service configuration for Chroma instances
  service:
    type: ClusterIP

  # Resources for Chroma containers
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 200m
      memory: 512Mi

  # Chroma servers configuration
  # Map of language (lowercase) to configuration
  servers: {}
    # Example configuration:
    # chs:
    #   checkpointPath: "checkpoint_web/chs"

# Extra manifests (e.g., for SealedSecrets)
extraManifests: []
  # Example: To inject a SealedSecret, add it to extraManifests like this:
  # - |
  #   apiVersion: bitnami.com/v1alpha1
  #   kind: SealedSecret
  #   metadata:
  #     name: {{ .Release.Name }}-secret
  #     namespace: {{ .Release.Namespace }}
  #   spec:
  #     secretName: {{ .Release.Name }}-secret
  #     encryptedData:
  #       LANGSMITH_API_KEY: AgBy3RTqp8sQKJ+QKZw...
  #       LANGSMITH_PROJECT: AgBxY8mQK+QKZw...
  #       LANGSMITH_TRACING: AgCdXRTqp8sQKJ...
  #       GOOGLE_API_KEY: AgD9Y8mQK+QKZw...
  #       CO_API_KEY: AgE1RTqp8sQKJ...
  #       OPENAI_API_KEY: AgF5Y8mQK+QKZw...
