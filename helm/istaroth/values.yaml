# Default values for istaroth.

# Backend configuration
backend:
  replicaCount: 1
  image:
    repository: isundaylee/istaroth
    tag: latest
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 8000

  # Checkpoint release version to download (e.g., "latest", "v1.0.0", or a git tag)
  checkpointRelease: "latest"

  resources:
    limits:
      cpu: 2
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

  # Environment variables - supports both direct values and valueFrom references
  # Add deployment-specific environment variables here
  env: []
    # Example: Database URI from secret (REQUIRED)
    # - name: ISTAROTH_DATABASE_URI
    #   valueFrom:
    #     secretKeyRef:
    #       name: db-credentials
    #       key: database-uri

    # Secrets are managed via SealedSecrets
    # Create a SealedSecret that generates a Secret named: {release-name}-secret

  probes:
    startup:
      httpGet:
        path: /api/models
        port: 8000
      periodSeconds: 5
      timeoutSeconds: 5
      failureThreshold: 36
    liveness:
      httpGet:
        path: /api/models
        port: 8000
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      httpGet:
        path: /api/models
        port: 8000
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

# Frontend configuration
frontend:
  replicaCount: 1
  image:
    repository: isundaylee/istaroth-frontend
    tag: latest
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 80

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

  env: {}

  probes:
    startup:
      httpGet:
        path: /
        port: 8080
      periodSeconds: 5
      timeoutSeconds: 5
      failureThreshold: 36
    liveness:
      httpGet:
        path: /
        port: 8080
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      httpGet:
        path: /
        port: 8080
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

# MCP server configuration (no MCP resources are created if languages is empty)
mcp:
  # Image for MCP servers (defaults match backend image)
  image:
    repository: isundaylee/istaroth
    tag: latest
    pullPolicy: IfNotPresent

  # Languages to run MCP servers for (must match keys in .Values.languages)
  # Example:
  # languages:
  #   - eng
  #   - chs
  languages: []

  # Service configuration for MCP instances
  service:
    type: ClusterIP
    port: 8000

  resources:
    limits:
      cpu: 2
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

  # Extra environment variables for MCP pods
  env: []

  probes:
    startup:
      tcpSocket:
        port: 8000
      periodSeconds: 5
      timeoutSeconds: 5
      failureThreshold: 36
    liveness:
      tcpSocket:
        port: 8000
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      tcpSocket:
        port: 8000
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

# Language configurations
languages:
  eng:
    useChroma: false  # Set to true to use a separate Chroma server pod

# ConfigMap for application configuration
configmap:
  data:
    # ISTAROTH_DOCUMENT_STORE_SET and ISTAROTH_EXTERNAL_CHROMA_SERVERS are generated from languages config
    ISTAROTH_AVAILABLE_MODELS: "all"
    ISTAROTH_QUERY_TRANSFORMER: "rewrite"
    ISTAROTH_RERANKER: "cohere"

# Persistent storage configuration for backend application data
persistence:
  storageClass: ""  # Leave empty to use default storage class
  accessMode: ReadWriteOnce
  size: 10Gi


# Service configuration
service:
  type: ClusterIP
  annotations: {}

# Ingress configuration
ingress:
  enabled: false
  className: traefik
  annotations: {}
  hosts:
    - host: istaroth.example.com

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Container security context
containerSecurityContext: {}

# Additional labels
labels: {}

# Additional annotations
annotations: {}

# Retrieval microservice configuration (uses backend.image)
retrieval:
  service:
    type: ClusterIP
    port: 8002

  resources:
    limits:
      cpu: 4
      memory: 4Gi
    requests:
      cpu: 1
      memory: 2Gi

  env: []

  probes:
    startup:
      httpGet:
        path: /health
        port: 8002
      periodSeconds: 5
      timeoutSeconds: 5
      failureThreshold: 36
    liveness:
      httpGet:
        path: /health
        port: 8002
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      httpGet:
        path: /health
        port: 8002
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

# Embedding microservice configuration (uses backend.image)
embedding:
  enabled: true

  service:
    type: ClusterIP
    port: 8001

  resources:
    limits:
      cpu: 4
      memory: 4Gi
    requests:
      cpu: 1
      memory: 2Gi

  env: []

  probes:
    startup:
      httpGet:
        path: /health
        port: 8001
      periodSeconds: 5
      timeoutSeconds: 5
      failureThreshold: 36
    liveness:
      httpGet:
        path: /health
        port: 8001
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      httpGet:
        path: /health
        port: 8001
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

# Chroma services configuration (when using separate Chroma server pod)
chroma:
  # Chroma container image
  image:
    repository: chromadb/chroma
    tag: latest
    pullPolicy: IfNotPresent

  # Service configuration for Chroma instances
  service:
    type: ClusterIP

  # Resources for Chroma containers
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 200m
      memory: 512Mi

  # Environment variables for Chroma containers
  env:
    - name: RUST_BACKTRACE
      value: "1"

# Extra manifests (e.g., for SealedSecrets)
extraManifests: []
  # Example: To inject a SealedSecret, add it to extraManifests like this:
  # - |
  #   apiVersion: bitnami.com/v1alpha1
  #   kind: SealedSecret
  #   metadata:
  #     name: {{ .Release.Name }}-secret
  #     namespace: {{ .Release.Namespace }}
  #   spec:
  #     secretName: {{ .Release.Name }}-secret
  #     encryptedData:
  #       LANGSMITH_API_KEY: AgBy3RTqp8sQKJ+QKZw...
  #       LANGSMITH_PROJECT: AgBxY8mQK+QKZw...
  #       LANGSMITH_TRACING: AgCdXRTqp8sQKJ...
  #       GOOGLE_API_KEY: AgD9Y8mQK+QKZw...
  #       CO_API_KEY: AgE1RTqp8sQKJ...
  #       OPENAI_API_KEY: AgF5Y8mQK+QKZw...
