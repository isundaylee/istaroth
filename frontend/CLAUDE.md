# Frontend Development Guide

## Localization System

React context-based i18n supporting Chinese (CHS) and English (ENG).

### Structure
```
src/i18n/          # Translation files (chs.ts, eng.ts, index.ts)
src/contexts/      # LanguageContext.tsx
```

### Usage
```tsx
import { useTranslation } from '../contexts/LanguageContext'

const { t, language, setLanguage } = useTranslation()
return <button>{t.common.submit}</button>
```

### Adding Translations
1. Add identical keys to both `chs.ts` and `eng.ts`
2. Use `t.feature.key` in components
3. TypeScript enforces matching structures

### Notes
- Auto-detects browser language, persists to localStorage
- Use nested keys for organization (e.g., `citation.*`, `query.*`)

## API Type Generation

### Overview
Frontend types are automatically generated from the backend's OpenAPI specification, ensuring type safety and eliminating manual synchronization between frontend and backend API contracts.

### Type System
- **Auto-Generated Types**: `src/types/api-generated.ts` (do not edit manually)
- **Type Exports**: `src/types/api.ts` imports and re-exports generated types
- **Single Source of Truth**: Backend Pydantic models drive all type definitions

### Type Generation Workflow
```bash
# Generate types from latest OpenAPI spec
npm run generate-types

# Build with automatic type generation (runs generate-types first)
npm run build
```

### File Structure
```
frontend/
├── openapi.json           # OpenAPI spec (generated by backend)
├── generate-types.js      # Type generation script
└── src/types/
    ├── api-generated.ts   # Auto-generated from OpenAPI spec (do not edit)
    └── api.ts            # Imports and re-exports generated types
```

### Development Workflow
1. **Backend Changes**: Backend updates Pydantic models in `models.py`
2. **Generate OpenAPI**: Backend runs `python scripts/generate_openapi.py`
3. **Build Frontend**: Frontend build automatically generates TypeScript types from `frontend/openapi.json`
4. **Type Safety**: Build fails if API contract changes break compatibility

### Scripts
- `npm run generate-types`: Generate TypeScript types from OpenAPI spec
- `npm run build`: Build with automatic type generation (includes prebuild step)

### Best Practices
- **Never edit `api-generated.ts`**: It's automatically overwritten
- **Use generated types**: Import from `./types/api` not `./types/api-generated`
- **Handle type changes**: Update components when backend API contracts change
- **Leverage TypeScript**: Use strict typing to catch API mismatches at build time

### Troubleshooting
- **Build failures**: Usually indicate API contract changes that require frontend updates
- **Missing types**: Ensure backend OpenAPI spec is up-to-date
- **Type mismatches**: Check if backend models changed and regenerate types

### Dependencies
- `openapi-typescript`: Generates TypeScript types from OpenAPI specs
- Build integration via `prebuild` script in `package.json`
